<div id='orders'>
  <div class='row'>
    <div class='col-sm-12'>
      <div class='page-header'>
        <h1 class='pull-left'>
          <i class='icon-inbox'></i>
          <span>Devis</span>
        </h1>
      </div>
      <div class='row'>
        <div class='col-sm-12'>
          <div class="box bordered-box orange-border hide" style="margin-bottom:0;">
                    <div class="box-header purple-background">
                      <div class="title">Data table with column filter in footer</div>
                      <div class="actions">
                        <a class="btn box-remove btn-xs btn-link" href="#"><i class="icon-remove"></i>
                        </a>
                        
                        <a class="btn box-collapse btn-xs btn-link" href="#"><i></i>
                        </a>
                      </div>
                    </div>
                    <div class="box-content box-no-padding">
                      <div class="responsive-table">
                        <div class="scrollable-area">
                          <div id="DataTables_Table_1_wrapper" class="dataTables_wrapper form-inline" role="grid"><div class="row datatables-top"><div class="col-sm-6"><div id="DataTables_Table_1_length" class="dataTables_length"><label><select size="1" name="DataTables_Table_1_length" aria-controls="DataTables_Table_1"><option value="10" selected="selected">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> records per page</label></div></div><div class="col-sm-6 text-right"><div class="dataTables_filter" id="DataTables_Table_1_filter"><label>Search: <input type="text" aria-controls="DataTables_Table_1" class="form-control input-sm" placeholder="Search... " style="width: 200px;"></label></div></div></div><table class="data-table-column-filter table table-bordered table-striped dataTable" style="margin-bottom:0;" id="DataTables_Table_1" aria-describedby="DataTables_Table_1_info">
                            <thead>
                              <tr role="row"><th class="sorting_asc" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" aria-sort="ascending" aria-label="
                                  Name
                                : activate to sort column descending" style="width: 364px;">
                                  Name
                                </th><th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" aria-label="
                                  E-mail
                                : activate to sort column ascending" style="width: 384px;">
                                  E-mail
                                </th><th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" aria-label="
                                  Status
                                : activate to sort column ascending" style="width: 185px;">
                                  Status
                                </th><th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" aria-label=": activate to sort column ascending" style="width: 153px;"></th></tr>
                            </thead>
                            
                            <tfoot>
                              <tr><th rowspan="1" colspan="1"><span class="filter_column filter_text"><input type="text" class="text_filter search_init" value="Name"></span></th><th rowspan="1" colspan="1"><span class="filter_column filter_text"><input type="text" class="search_init text_filter" value="E-mail"></span></th><th colspan="2" rowspan="1"><span class="filter_column filter_text"><input type="text" class="search_init text_filter" value="Status"></span></th></tr>
                            </tfoot>
                          <tbody role="alert" aria-live="polite" aria-relevant="all"><tr class="odd">
                                <td class=" sorting_1">Ahmed Sanford</td>
                                <td class=" ">jon@gmail.com</td>
                                <td class=" ">
                                  <span class="label label-important">Important</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="even">
                                <td class=" sorting_1">Audrey Hansen</td>
                                <td class=" ">cali@gmail.com</td>
                                <td class=" ">
                                  <span class="label label-warning">Warning</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="odd">
                                <td class=" sorting_1">August Rice</td>
                                <td class=" ">austyn@yahoo.com</td>
                                <td class=" ">
                                  <span class="label label-success">Success</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="even">
                                <td class=" sorting_1">Brionna Oberbrunner</td>
                                <td class=" ">hoyt@gmail.com</td>
                                <td class=" ">
                                  <span class="label label-important">Important</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="odd">
                                <td class=" sorting_1">Clare Harvey</td>
                                <td class=" ">marlene@gmail.com</td>
                                <td class=" ">
                                  <span class="label label-warning">Warning</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="even">
                                <td class=" sorting_1">Davion Rowe</td>
                                <td class=" ">simone@gmail.com</td>
                                <td class=" ">
                                  <span class="label label-warning">Warning</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="odd">
                                <td class=" sorting_1">Domenick Runte</td>
                                <td class=" ">godfrey@hotmail.com</td>
                                <td class=" ">
                                  <span class="label label-important">Important</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="even">
                                <td class=" sorting_1">Elnora Balistreri</td>
                                <td class=" ">desmond@yahoo.com</td>
                                <td class=" ">
                                  <span class="label label-warning">Warning</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="odd">
                                <td class=" sorting_1">Ericka Heidenreich</td>
                                <td class=" ">niko@yahoo.com</td>
                                <td class=" ">
                                  <span class="label label-warning">Warning</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr><tr class="even">
                                <td class=" sorting_1">Flavie Stracke</td>
                                <td class=" ">verna@gmail.com</td>
                                <td class=" ">
                                  <span class="label label-warning">Warning</span>
                                </td>
                                <td class=" ">
                                  <div class="text-right">
                                    <a class="btn btn-success btn-xs" href="#">
                                      <i class="icon-ok"></i>
                                    </a>
                                    <a class="btn btn-danger btn-xs" href="#">
                                      <i class="icon-remove"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr></tbody></table><div class="row datatables-bottom"><div class="col-sm-6"><div class="dataTables_info" id="DataTables_Table_1_info">Showing 1 to 10 of 20 entries</div></div><div class="col-sm-6 text-right"><div class="dataTables_paginate paging_bootstrap"><ul class="pagination pagination-sm"><li class="prev disabled"><a href="#">← Previous</a></li><li class="active"><a href="#">1</a></li><li><a href="#">2</a></li><li class="next"><a href="#">Next → </a></li></ul></div></div></div></div>
                        </div>
                      </div>
                    </div>
                  </div>






          <a class="btn btn-success btn-block btn-lg" type="button" href="/quotes/new">Nouveau devis</a>
          <p></p>
          <div class='box'>
            <div class='box-content'> 
                    <div class='row'>

              <div class='col-sm-4'>
                <div class='pull-left'>
                  
                  <p><h4>Titre du devis <a href="/quotes?order=1"><i class="icon-sort-up"></i></a> <a href="/quotes?order=2"><i class="icon-sort-down"></i></a></h4></p>
                  &nbsp;&nbsp;&nbsp;Nom client <a href="/quotes?order=3"><i class="icon-sort-up"></i></a> <a href="/quotes?order=4"><i class="icon-sort-down"></i></a>

                  
               </div>
             </div>
            <div class='col-sm-3'>
               <div class='pull-right'>
                  
                  <p><h4>Montant <a href="/quotes?order=5"><i class="icon-sort-up"></i></a> <a href="/quotes?order=6"><i class="icon-sort-down"></i></a></h4></p>
                  &nbsp;&nbsp;&nbsp;Date de création <a href="/quotes?order=7"><i class="icon-sort-up"></i></a> <a href="/quotes?order=8"><i class="icon-sort-down"></i></a>
                  
               </div>
             </div>
             <div class='col-sm-3 text-center'>
            <p><h4>Statut <a href="/quotes?order=9"><i class="icon-sort-up"></i></a> <a href="/quotes?order=10"><i class="icon-sort-down"></i></a></h4></p>
             </div>
             <div class='col-sm-2'>

             </div>
            </div>

          </div>
        </div>
          <div class='box'>
            <div class='box-content'> 
              <% @quotes.each do |quote| %>
                <tr>
                  <div class='col-sm-7'>
                      <div class='pull-left'>
                        <p>
                          <%= link_to(quote) do %>
                            <h4>#<%= quote.id %>  <%= quote.title %> </h4>

                          <% end %>
                        </p>
                        <p>
                          <% @client=Client.find_by_id(quote.client_id) %>

                            <%= link_to(clients_path) do %>
                              <%=@client.first_name.capitalize%> <%=@client.last_name.capitalize %>                                            

                            <% end %>
                        </p>  
                      </div>
                      <div class='text-right pull-right'>

                        <% 
                        @tax_rate=quote.tax_rate
                        if @tax_rate==nil
                          @tax_rate=0
                        end 
                        %>
                        <h4 class='contrast price'><%= quote.total.to_d*(1+@tax_rate.to_d) if quote.total!=nil %> € TTC</h4>
                        <p>
                          <span><%= distance_of_time_in_words(Time.now, quote.created_at) %></span>
                          <i class='icon-time'></i>
                        </p>
                      </div>
                  </div>

                  <div class='col-sm-3 text-center'>
                    <p><a data-toggle="modal" href="#modal-status_<%=quote.id%>"><h4><span class="label 
                      <%="label-important" if quote.status==0%><%="label-warning" if quote.status==1%><%="label-success" if quote.status==2%>"><%="Devis refusé" if quote.status==0%><%="Devis en cours" if quote.status==1%><%="Devis accepté" if quote.status==2%></span></h4></a></p>
                  </div>   
                  <div class='col-sm-2'>
                   <div class='text-right text-center'>
                    <h4>
                    <a href="" class='has-tooltip' data-placement="top" data-original-title="Visualiser"onclick="window.open('/visu_pdf/quote_visu.<%= quote.id %>','_blank');"><i class="icon-search"></i></a>
                      &nbsp;
                    <a class='has-tooltip' data-placement="top" data-original-title="Facturer" data-toggle="modal" href="/quotes/<%= quote.id %>/invoice"><i class="icon-money"></i></a>
                      &nbsp; 
                    <%= link_to '<i class="icon-trash"></i>'.html_safe, quote, method: :delete, data: { confirm: 'Etes vous sûr de vouloir supprimer ce devis?', placement: "top", original_title: "Supprimer" },class: 'has-tooltip' %>
                    </h4>
                   </div> 
                  </div> 
                     <div class='modal fade' id='modal-status_<%=quote.id%>' tabindex='1'>
                      <div class='modal-dialog'>
                        <div class='modal-content'>
                          <div class='modal-header'>
                            <button aria-hidden='true' class='close' data-dismiss='modal' type='button'>×</button>
                            <h4 class='modal-title' id='myModalLabel'>Modifier le statut du devis #<%=quote.id%> - <%=quote.title%></h4>
                          </div>
                          <div class='modal-body'>
                            <form class="form" style="margin-bottom: 0;" method="post" action="#" accept-charset="UTF-8"><input name="authenticity_token" type="hidden" />
                              <div class='form-group'>
                                <label for='status'>Statut</label>
                                <select class="form-control input-sm" data-rule-required="true" id="status_select_<%=quote.id%>" name="validation_select">
                                    <option <%= "selected" if quote.status==1 %>>Devis en cours</option>
                                    <option <%= "selected" if quote.status==2 %>>Devis accepté</option>
                                    <option <%= "selected" if quote.status==0 %>>Devis refusé</option>
                                </select>
                              </div>
                            </form>
                          </div>
                          <div class='modal-footer'>
                            <button class='btn btn-default' data-dismiss='modal' type='button'>Fermer sans modifier le statut</button>
                            <button class='btn btn-success' data-dismiss='modal' type='button' onclick="quoteStatus(<%= quote.id %>);">Modifier le statut</button>
                          </div>
                        </div>
                      </div>
                    </div>  
                  <div class='clearfix'></div>
                  <hr class='hr-normal'>
                </tr>
              <% end %>
            </div>
            
          </div>
        </div>
      </div>
    </div>
    
  </div>

  <script type="text/javascript">
  $( document ).ready(function() {
    $("#nav_quote").toggleClass('active');
});

function quoteStatus(id) {
var status_select="status_select_"+id;
var status="";
    if (document.getElementById(status_select)==null){
      status=1;
    }
    else{
      if (document.getElementById(status_select).value=="Devis en cours") {
        status=1;
      };
      if (document.getElementById(status_select).value=="Devis accepté") {
        status=2;
      };
      if (document.getElementById(status_select).value=="Devis refusé") {
        status=0;
      };
    }
var url_send= "/quotes/"+id+"/status";  
var request=$.ajax({
url: url_send,
type: "PUT",
beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
data: {q_param: {
         status: status
       }}
});

request.done(finishStatus(id));
}

function finishStatus(id){
  var url_show;
  url_show="/quotes";
 window.location.replace(url_show);
}


      $("#daterange2").daterangepicker({
        format: "MM/DD/YYYY"
      }, function(start, end) {
        return $("#daterange2").parent().find("input").first().val(start.format("MMMM D, YYYY") + " - " + end.format("MMMM D, YYYY"));
      });
      
  </script>


<br>